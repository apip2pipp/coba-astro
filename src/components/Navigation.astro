---
// Navigation component
---

<nav id="main-nav" data-theme="dark" class="fixed top-0 left-0 right-0 z-50 backdrop-blur-md transition-all duration-500 ease-in-out">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center h-16 gap-4">
      <!-- Logo -->
      <div class="flex-shrink-0">
        <a href="#home" class="nav-logo-wrapper flex items-center gap-3 transition-colors duration-300">
          <!-- Animated Circle Logo -->
          <div class="nav-logo-circle">
            <div class="nav-logo-inner"></div>
          </div>
          <!-- Text Logo -->
          <span class="nav-logo text-2xl font-bold">Kieee</span>
        </a>
      </div>

      <!-- Desktop Navigation -->
      <div class="hidden md:flex flex-1 justify-center items-center gap-6">
        {[
          { href: '#home', label: 'Home' },
          { href: '#about', label: 'About' },
          { href: '#projects', label: 'Projects' },
          { href: '#certificates', label: 'Certificates' },
          { href: '#contact', label: 'Contact' },
        ].map((item) => (
          <a href={item.href} class="nav-link px-3 py-2 text-sm font-medium transition-colors duration-300">
            {item.label}
          </a>
        ))}
      </div>

      <!-- Action buttons -->
      <div class="flex items-center gap-2 ml-auto">
        <button
          id="theme-toggle"
          type="button"
          class="theme-toggle hidden md:inline-flex items-center justify-center w-10 h-10 rounded-full border transition-all duration-300 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-400"
          aria-label="Toggle nav theme"
          aria-pressed="false"
        >
          <svg class="sun h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <circle cx="12" cy="12" r="5" />
            <path d="M12 1v2m0 18v2m11-11h-2M3 12H1m18.364 7.364l-1.414-1.414M6.05 6.05 4.636 4.636m0 14.728L6.05 17.95M19.364 4.636 17.95 6.05" />
          </svg>
          <svg class="moon h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79Z" />
          </svg>
        </button>

        <!-- Mobile menu button -->
        <button id="mobile-menu-button" class="mobile-trigger md:hidden flex items-center justify-center w-10 h-10 rounded-full border transition-colors duration-300 focus:outline-none">
          <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile Navigation -->
  <div id="mobile-menu" class="md:hidden hidden border-t">
    <div class="px-4 pt-2 pb-3 space-y-1">
      {[
        { href: '#home', label: 'Home' },
        { href: '#about', label: 'About' },
        { href: '#projects', label: 'Projects' },
        { href: '#certificates', label: 'Certificates' },
        { href: '#contact', label: 'Contact' },
      ].map((item) => (
        <a href={item.href} class="nav-link block rounded-md px-3 py-2 text-base font-medium transition-colors duration-300">
          {item.label}
        </a>
      ))}
      <button
        id="theme-toggle-mobile"
        type="button"
        class="theme-toggle w-full flex items-center justify-between rounded-lg border px-3 py-2 text-sm font-semibold transition-colors duration-300"
        aria-label="Toggle nav theme"
        aria-pressed="false"
      >
        <span>Toggle Theme</span>
        <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79Z" />
        </svg>
      </button>
    </div>
  </div>
</nav>

<script>
  // Mobile menu toggle
  document.addEventListener('DOMContentLoaded', function() {
    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');
    const nav = document.getElementById('main-nav');
    const desktopToggle = document.getElementById('theme-toggle');
    const mobileToggle = document.getElementById('theme-toggle-mobile');
    const THEME_KEY = 'site-theme';
    const root = document.documentElement;
    const applyTheme = (theme: string) => {
      const resolved = theme === 'light' ? 'light' : 'dark';
      root.classList.toggle('dark', resolved === 'dark');
      root.dataset.theme = resolved;
      if (nav) {
        nav.setAttribute('data-theme', resolved);
      }
      const future = resolved === 'dark' ? 'light' : 'dark';
      [desktopToggle, mobileToggle].forEach((btn) => {
        if (!btn) return;
        btn.setAttribute('aria-pressed', String(resolved === 'light'));
        btn.setAttribute('aria-label', `Switch to ${future} theme`);
      });
    };

    const saved = localStorage.getItem(THEME_KEY);
    applyTheme(saved || root.dataset.theme || 'dark');

    const toggleTheme = () => {
      const current = root.dataset.theme === 'light' ? 'light' : 'dark';
      const next = current === 'light' ? 'dark' : 'light';
      localStorage.setItem(THEME_KEY, next);
      applyTheme(next);
    };

    [desktopToggle, mobileToggle].forEach((btn) => {
      btn?.addEventListener('click', toggleTheme);
    });
    
    if (mobileMenuButton && mobileMenu) {
      mobileMenuButton.addEventListener('click', function() {
        mobileMenu.classList.toggle('hidden');
      });
    }

    // Smooth scrolling for navigation links with custom duration
    const smoothScrollTo = (target: Element, duration = 1000) => {
      const targetPosition = target.getBoundingClientRect().top + window.pageYOffset;
      const startPosition = window.pageYOffset;
      const distance = targetPosition - startPosition;
      let startTime: number | null = null;

      const animation = (currentTime: number) => {
        if (startTime === null) startTime = currentTime;
        const timeElapsed = currentTime - startTime;
        const run = ease(timeElapsed, startPosition, distance, duration);
        window.scrollTo(0, run);
        if (timeElapsed < duration) requestAnimationFrame(animation);
      };

      // Easing function for smooth animation
      const ease = (t: number, b: number, c: number, d: number) => {
        t /= d / 2;
        if (t < 1) return c / 2 * t * t + b;
        t--;
        return -c / 2 * (t * (t - 2) - 1) + b;
      };

      requestAnimationFrame(animation);
    };

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e: Event) {
        e.preventDefault();
        const href = (e.currentTarget as HTMLAnchorElement).getAttribute('href');
        const target = href ? document.querySelector(href) : null;
        if (target) {
          smoothScrollTo(target, 1000); // 1000ms = 1 second duration
          // Close mobile menu if open
          mobileMenu?.classList.add('hidden');
        }
      });
    });

    // Scroll-based navigation hide/show with delay
    let lastScrollTop = 0;
    let scrollTimeout: number | undefined;
    const scrollDelay = 150; // Delay in milliseconds (0.15 seconds)
    
    window.addEventListener('scroll', function() {
      clearTimeout(scrollTimeout);
      
      scrollTimeout = window.setTimeout(function() {
        const currentScrollTop = window.pageYOffset || document.documentElement.scrollTop;
        
        // Only apply animation if scrolled past 100px
        if (currentScrollTop > 100) {
          if (currentScrollTop > lastScrollTop) {
            // Scrolling down
            if (nav) nav.style.transform = 'translateY(-100%)';
          } else {
            // Scrolling up
            if (nav) nav.style.transform = 'translateY(0)';
          }
        } else {
          // At the top, always show
          if (nav) // At the top, always show
          nav.style.transform = 'translateY(0)';
        }
        
        lastScrollTop = currentScrollTop <= 0 ? 0 : currentScrollTop;
      }, scrollDelay);
    });
  });
</script>

<style>
  #main-nav {
    border-bottom: 1px solid var(--nav-border);
    background: var(--nav-bg);
    color: var(--nav-text);
  }

  #main-nav[data-theme='dark'] {
    --nav-bg: rgba(2, 6, 23, 0.92);
    --nav-border: rgba(15, 23, 42, 0.8);
    --nav-link: rgba(226, 232, 240, 0.85);
    --nav-link-hover: #a3e635;
    --nav-logo: #4ade80;
    --nav-menu-bg: rgba(2, 6, 23, 0.95);
    --nav-button-bg: rgba(15, 23, 42, 0.65);
    --nav-button-text: #e2e8f0;
    --nav-button-border: rgba(71, 85, 105, 0.8);
  }

  #main-nav[data-theme='light'] {
    --nav-bg: rgba(255, 255, 255, 0.92);
    --nav-border: rgba(226, 232, 240, 0.9);
    --nav-link: #1f2937;
    --nav-link-hover: #16a34a;
    --nav-logo: #14532d;
    --nav-menu-bg: rgba(255, 255, 255, 0.98);
    --nav-button-bg: rgba(241, 245, 249, 0.95);
    --nav-button-text: #0f172a;
    --nav-button-border: rgba(203, 213, 225, 0.9);
  }

  #main-nav .nav-logo {
    color: var(--nav-logo);
  }

  /* Animated Circle Logo */
  .nav-logo-wrapper {
    text-decoration: none;
  }

  .nav-logo-circle {
    position: relative;
    width: 36px;
    height: 36px;
    border: 2px solid var(--nav-logo);
    border-radius: 50%;
    animation: navCircleRotate 8s linear infinite;
    transition: all 0.3s ease;
  }

  .nav-logo-circle::before {
    content: '';
    position: absolute;
    top: 2px;
    left: 2px;
    right: 2px;
    bottom: 2px;
    border-radius: 50%;
    background: var(--nav-logo);
    opacity: 0.1;
  }

  .nav-logo-inner {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 14px;
    height: 14px;
    background: var(--nav-logo);
    border-radius: 50%;
    animation: navInnerPulse 2s ease-in-out infinite;
    box-shadow: 0 0 8px var(--nav-logo);
  }

  @keyframes navCircleRotate {
    from {
      transform: rotate(0deg);
    }
    to {
      transform: rotate(360deg);
    }
  }

  @keyframes navInnerPulse {
    0%, 100% {
      transform: translate(-50%, -50%) scale(1);
      opacity: 1;
    }
    50% {
      transform: translate(-50%, -50%) scale(1.2);
      opacity: 0.8;
    }
  }

  .nav-logo-wrapper:hover .nav-logo-circle {
    transform: scale(1.1);
    border-color: var(--nav-link-hover);
  }

  .nav-logo-wrapper:hover .nav-logo-inner {
    background: var(--nav-link-hover);
    box-shadow: 0 0 12px var(--nav-link-hover);
  }

  .nav-logo-wrapper:hover .nav-logo {
    color: var(--nav-link-hover);
  }

  #main-nav .nav-link {
    color: var(--nav-link);
  }

  #main-nav .nav-link:hover,
  #main-nav .nav-link:focus-visible {
    color: var(--nav-link-hover);
  }

  #main-nav .theme-toggle,
  #main-nav .mobile-trigger {
    background: var(--nav-button-bg);
    color: var(--nav-button-text);
    border-color: var(--nav-button-border);
  }

  #main-nav #mobile-menu {
    background: var(--nav-menu-bg);
    border-color: var(--nav-border);
  }

  #main-nav .sun {
    display: none;
  }

  #main-nav[data-theme='light'] .sun {
    display: block;
  }

  #main-nav[data-theme='light'] .moon {
    display: none;
  }
</style>
